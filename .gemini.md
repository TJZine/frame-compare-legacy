# PROJECT CONSTITUTION & GUARDRAILS

## 1. Architecture & Quality Gates
- **Type Safety:**
  - **Python:** Strict conformance. No `Any`. Explicit `Optional` handling.
  - **Check:** Must pass `.venv/bin/pyright` (or `uv run pyright`) with 0 errors before submission.
- **Testing:**
  - **Mandatory:** Every code change requires a verification test.
  - **Constraint:** No external network calls in tests (mock everything).
  - **Command:** `.venv/bin/pytest -q` must pass.

## 2. Tooling Strategy (MCP Priority)
You have access to specialized MCP tools. You must use them in this specific order:

### A. Code Discovery & Impact Analysis
1.  **Primary:** `codanna`
    - Start with `codanna.semantic_search_with_context` to understand the domain.
    - Use `codanna.analyze_impact` before modifying shared code to visualize breaking changes.
    - Use `codanna.find_callers` to trace execution paths safely.
2.  **Secondary:** `ripgrep`
    - Use only if Codanna returns no results or for simple text-string matches (e.g., TODOs).

### B. Documentation & Best Practices
1.  **Primary:** `context7`
    - Use this for official library documentation and best practices.
    - Cite specific snippets from Context7 in your plan.

## 3. Execution Policy
- **Read-Only:** You are free to run `ls`, `cat`, `grep`, `rg` and all `codanna.*` read tools.
- **Write/Edit:**
  - **Small Changes (<300 lines):** Auto-approved if tests pass.
  - **Risky Changes:** Explicit approval required for `.github/workflows`, `Dockerfile`, auth logic, or secrets.